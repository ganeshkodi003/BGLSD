<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css"
	href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/font-awesome/5.9.0/css/all.min.css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
	th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script src="/webjars/jquery/3.4.1/jquery.min.js"
	th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
	th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>

<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
	th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>

<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
	th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>
<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script
	src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>
<style>
body {
	font-size: 0.8rem;
}

.btn {
	line-height: 0.5rem;
}

.table-bordered td, .table-bordered th {
	font-size: smaller;
}

.container-manager {
	width: 83.5%;
	padding-right: 15px;
	padding-left: 15px;
	margin-right: auto;
	margin-left: 17.3%;
	margin-top: 80px;
	margin-top: 80px;
}

.table .thead-light th {
	color: #495057;
	background-color: #e9ecef;
	border-color: #dee2e6;
	width: 23px;
}

.scroll {
	max-height: 60vh;
	overflow-y: scroll;
	overflow-x: hidden;
}

.tablinks {
	background-color: #f1f1f1;
	/* Default background color */
	border: none;
	color: black;
	padding: 10px 20px;
	text-align: center;
	text-decoration: none;
	display: inline-block;
	font-size: 16px;
	transition: background-color 0.3s;
}

.tablinks.active {
	background-color: #2084a9;
	color: white;
}

.tab {
	overflow: hidden;
	border: 1px solid #ccc;
	background-color: #f2f2f2;
}

.tab button {
	background-color: inherit;
	float: left;
	border: none;
	outline: none;
	cursor: pointer;
	padding: 14px 56px;
	transition: 0.3s;
	font-size: 17px;
}

.tab button:hover {
	background-color: #ddd;
}

.tabcontent {
	display: none;
	padding: 0px;
	border-top: 1px solid #ccc;
}

.active {
	background-color: #2084a9;
}

#myPieChart {
	width: 100px;
	height: 100px;
}
</style>
<style>
.modal {
	display: none;
	/* Hidden by default */
	position: absolute;
	/* Stay in place */
	z-index: 1;
	/* Location of the box */
	left: 0;
	top: 0;
	width: 100%;
	/* Full width */
	height: 100%;
	/* Full height */
	overflow: auto;
	/* Enable scroll if needed */
	background-color: rgb(0, 0, 0);
	/* Fallback color */
	background-color: rgba(0, 0, 0, 0.4);
	/* Black w/ opacity */
}

/* Modal Content */
.modal-content {
	background-color: #fefefe;
	margin: auto;
	padding: 20px;
	border: 1px solid #888;
	width: 100%;
	box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0
		rgba(0, 0, 0, 0.19);
	-webkit-animation-name: animatetop;
	-webkit-animation-duration: 0.4s;
	animation-name: animatetop;
	animation-duration: 0.4s
}

.modal-pass {
	background-color: #fefefe;
	margin: 15% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 40%;
	height: 25%;
	margin-left: 400PX;
	margin-right: auto;
	border-radius: 10px;
	box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2);
	font-family: Arial, sans-serif;
}

.close {
	color: red;
	font-size: 28px;
	font-weight: bold;
}

.close:hover, .close:focus {
	color: black;
	text-decoration: none;
	cursor: pointer;
}
</style>
<style>
.password-info {
	visibility: hidden;
	width: 320px;
	background-color: #333;
	color: #fff;
	text-align: left;
	border-radius: 10px;
	padding: 10px;
	position: absolute;
	z-index: 1;
	top: calc(100% + 10px);
	left: 50%;
	transform: translateX(-50%);
	opacity: 0;
	transition: opacity 0.3s;
}

input:hover+.password-info {
	visibility: visible;
	opacity: 0.8;
}
</style>

<script>

		$(function () {
			$("#fromdate").datepicker({
				dateFormat: "dd-mm-yy",
				changeMonth: true,
				changeYear: true,
				onSelect: function (selectedDate) {
					// Set the minDate for the "To Date" based on the selected "From Date"
					$("#todate").datepicker("option", "minDate", selectedDate);
				}
			});

			$("#todate").datepicker({
				dateFormat: "dd-mm-yy",
				changeMonth: true,
				changeYear: true

			});
		});

		function Home() {

			location.href = 'Dashboard';
		}

		function back() {
			window.history.back();
		}

		function add() {

			location.href = './deposits?formmode=add';

		}

		function navigate() {

			location.href = './accountLedger';

		}

		function view(a) {
			var actno = a.getAttribute('data-act');
			location.href = './deposits?formmode=view&actno=' + actno;
		}

		function verify(a) {
			var actno = a.getAttribute('data-act');
			location.href = './deposits?formmode=verify&actno=' + actno;
		}

		function modify(a) {
			var actno = a.getAttribute('data-act');
			location.href = './deposits?formmode=modify&actno=' + actno;
		}

		function clickMe() {
			$('#alert').modal('show');
		}


		function postingvalues(radio) {
			var accountvalue = document.getElementById("depositeaccountno").value;
			var flowCode = radio.getAttribute('data-flow_code');
			var flowDate = radio.getAttribute('data-flow_date');
			var flowAmount = radio.getAttribute('data-flow_amount');
			var currency = document.getElementById('currency').value;

			var url = 'journalEntries?formmode=add&account_no='
				+ encodeURIComponent(accountvalue) + '&flow_code='
				+ encodeURIComponent(flowCode) + '&flow_date='
				+ encodeURIComponent(flowDate) + '&flow_amount='
				+ encodeURIComponent(flowAmount) + '&currency='
				+ encodeURIComponent(currency);
			location.href = url;
		}
	</script>
<script>

		function callCollectionScreen(a) {
			event.preventDefault();
			location.href = 'leasecollection';
		}

		/* function callflowDetails() {
			getflowDetails();
		} */


		function getflowDetails() {
			event.preventDefault();

			var fromdate = $('#fromdate').val();
			var todate = $('#todate').val();

			var dateFrom = formatDateToDD(fromdate.trim());
			var DateTo = formatDateToDD(todate.trim());

			console.log(dateFrom + " " + DateTo);


			if ($('#interest').is(':checked')) {
				console.log("Interest option is checked.");

				$("#collectionTypeDiv").addClass("d-none");
				$("#serviceChargesTypeDiv").addClass("d-none");
				$("#flowIdTable").removeClass("d-none");
				$("#fromtovalues").removeClass("d-none");
				$("#operationtype").removeClass("d-none");
				$("#serviceflowIdTable").addClass("d-none");
				$("#repaymentTypeDiv").addClass("d-none");

				var operationType = "Interest";

				if ($('#loan').is(':checked')) {
					console.log("Loan option is checked.");
					$("#acct_num1").removeClass("d-none");
					$("#acct_num2").addClass("d-none");
					var acct_num = $("#acct_num1").val();
					$.ajax({
						type: 'GET',
						url: './loanflowDetails',
						data: {
							fromDate: dateFrom,
							todate: DateTo,
							accountNumber: acct_num
						},
						success: function (data) {
							console.log(data);

							var tHTML = "";
							if (data.length > 0) {
								$
									.each(
										data,
										function (index, entity) {


											var flowDate = entity.flow_date !== null ? formatDate(entity.flow_date)
												: "";
											var flowId = entity.flow_id !== null ? entity.flow_id
												: "";

											var flowCode = entity.flow_code !== null ? entity.flow_code
												: "";
											var flowAmount = entity.flow_amt !== null ? formatNumberWithCommas(entity.flow_amt)
												: "0.00";
											var acctNo = entity.loan_acct_no !== null ? entity.loan_acct_no
												: "";
											//var inst_pct = entity.inst_pct !== null ? entity.inst_pct : "";
											var acctName = entity.acct_name !== null ? entity.acct_name
												: "";


											tHTML += "<tr>"
												+ "<td><input type='text' name='flow_date' value='" + flowDate + "' class='border-0' readonly /></td>"
												+ "<td><input type='text' name='flow_id' value='" + flowId + "'  class='border-0' readonly  /></td>"
												+ "<td><input type='text' name='flow_code' value='" + flowCode + "' class='border-0' readonly  /></td>"
												+ "<td><input type='text' name='flow_amt' value='" + flowAmount + "' class='border-0' readonly  /></td>"
												+ "<td><input type='text' name='loan_acct_no' value='" + acctNo + "' class='border-0' readonly  /></td>"
												+ "<td><input type='text' name='acct_name' value='" + acctName + "' class='border-0' readonly  /></td>"

												+ "<td><input type='radio' onclick='handleRadioClickInterest(this);' data-flow_code='"
												+ flowCode
												+ "' data-loan_acct_no='"
												+ acctNo
												+ "' data-flow_amt='"
												+ flowAmount
												+ "' data-acct_name='" + acctName
												+ "' data-flow_date='" + flowDate
												+ "' data-flow_id='" + flowId
												+ "' data-operation='" + operationType
												+ "' name='und_pct_radio' /></td>"

												+ "</tr>";
										});
							} else {
								tHTML += "<tr><td colspan='7'>No records available</td></tr>";
							}
							$("#flowIdTbody").empty().append(tHTML);
						},
						error: function () {
							$('#errorMessage').text('Error fetching data');
							$('#errorModal').modal('show');
						}
					});

				} else {
					console.log("Deposit option is checked.");
					$("#acct_num2").removeClass("d-none");
					$("#acct_num1").addClass("d-none");
					$("#flowIdTable").removeClass("d-none");
					$("#fromtovalues").removeClass("d-none");
					$("#operationtype").removeClass("d-none");
					$("#serviceflowIdTable").addClass("d-none");
					$("#repaymentTypeDiv").addClass("d-none");
					var acct_num = $("#acct_num2").val();
					$.ajax({
						type: 'GET',
						url: './depositflowDetails',
						data: {
							fromDate: dateFrom,
							todate: DateTo,
							accountNumber: acct_num
						},
						success: function (data) {
							console.log(data);

							var tHTML = "";

							if (data.length > 0) {
								$.each(data, function (index, entity) {

									var flowDate = entity.flow_date !== null ? formatDate(entity.flow_date) : "";
									var flowId = entity.flow_id !== null ? entity.flow_id : "";
									var flowCode = entity.flow_code !== null ? entity.flow_code : "";
									var flowAmount = entity.flow_amt !== null ? formatNumberWithCommas(entity.flow_amt) : "0.00";
									var acctNo = entity.loan_acct_no !== null ? entity.acid : "";

									// Fetch account name for each account number
									$.ajax({
										type: 'GET',
										url: './depositAcctName',
										data: {
											acctNo: acctNo
										},
										success: function (acctNameData) {
											console.log("Account Name: " + acctNameData);
											var acctName = acctNameData.trim(); // Assign the returned account name

											// Now append the row once we have the account name
											tHTML += "<tr>"
												+ "<td><input type='text' name='flow_date' value='" + flowDate + "' class='border-0' readonly /></td>"
												+ "<td><input type='text' name='flow_id' value='" + flowId + "'  class='border-0' readonly  /></td>"
												+ "<td><input type='text' name='flow_code' value='" + flowCode + "' class='border-0' readonly  /></td>"
												+ "<td><input type='text' name='flow_amt' value='" + flowAmount + "' class='border-0' readonly  /></td>"
												+ "<td><input type='text' name='loan_acct_no' value='" + acctNo + "' class='border-0' readonly  /></td>"
												+ "<td><input type='text' name='acct_name' value='" + acctName + "' class='border-0' readonly  /></td>"
												+ "<td><input type='radio' onclick='handleRadioClickInterest(this);' data-flow_code='"
												+ flowCode
												+ "' data-loan_acct_no='" + acctNo
												+ "' data-flow_amt='" + flowAmount
												+ "' data-acct_name='" + acctName
												+ "' data-flow_date='" + flowDate
												+ "' data-flow_id='" + flowId
												+ "' data-operation='" + operationType
												+ "' name='und_pct_radio' /></td>"
												+ "</tr>";

											// Append after each row creation
											$("#flowIdTbody").empty().append(tHTML);

										},
										error: function () {
											$('#errorMessage').text('Error fetching account name');
											$('#errorModal').modal('show');
										}
									});
								});
							} else {
								tHTML += "<tr><td colspan='7'>No records available</td></tr>";
								$("#flowIdTbody").empty().append(tHTML);
							}
						},
						error: function () {
							$('#errorMessage').text('Error fetching data');
							$('#errorModal').modal('show');
						}
					});
				}
			} else if ($('#serviceCharges').is(':checked')) {
				console.log("Interest option is checked.");
				$("#serviceChargesTypeDiv").removeClass("d-none");
				$("#collectionTypeDiv").addClass("d-none");
				$("#flowIdTable").addClass("d-none");
				$("#fromtovalues").addClass("d-none");
				$("#operationtype").addClass("d-none");
				$("#serviceflowIdTable").removeClass("d-none");
				$("#acct_num11").removeClass("d-none");
				$("#repaymentTypeDiv").addClass("d-none");
				
				var acct_num = $("#acct_num11").val();

				$.ajax({
				    type: 'GET',
				    url: './getAccountNamedatas',
				    data: {
				        accountNum: acct_num
				    },
				    success: function (data) {
				        console.log(data);

				        if (data && acct_num) {  // Only update if data is received and acct_num is not empty
				            document.getElementById("loaaccountname").value = data;  
				            document.getElementById("loanaccountnumber").value = acct_num;  
				            document.getElementById("loaaccountnamedata").value = data;  

				            // Show the filename display
				            document.getElementById("filenameDisplay").classList.remove("d-none");
				        } else {
				            // Clear the field if no valid data is found
				            document.getElementById("loaaccountname").value = "";  
				            document.getElementById("loaaccountnamedata").value = "";
				            document.getElementById("filenameDisplay").classList.add("d-none"); // Hide again
				        }
				    },
				    error: function () {
				        $('#errorMessage').text('Error fetching data');
				        $('#errorModal').modal('show');
				    }
				});

			} else if ($('#collection').is(':checked')) {
				console.log("Collection option is checked.");

				$("#collectionTypeDiv").removeClass("d-none");
				$("#serviceChargesTypeDiv").addClass("d-none");
				$("#flowIdTable").removeClass("d-none");
				$("#fromtovalues").removeClass("d-none");
				$("#operationtype").removeClass("d-none");
				$("#serviceflowIdTable").addClass("d-none");
				$("#repaymentTypeDiv").addClass("d-none");

				if ($('#cash').is(':checked')) {

					var operationType = "CollectionCash";

					console.log("Cash option is checked.");

					if ($('#loan').is(':checked')) {
						console.log("Loan option is checked.");
						$("#acct_num1").removeClass("d-none");
						$("#acct_num2").addClass("d-none");
						
						var acct_num = $("#acct_num1").val();
						$.ajax({
							type: 'GET',
							url: './loanflowDetails1',
							data: {
								fromDate: dateFrom,
								todate: DateTo,
								accountNumber: acct_num
							},
							success: function (data) {
								console.log(data);

								var tHTML = "";
								if (data.length > 0) {
									$
										.each(
											data,
											function (index, entity) {


												var flowDate = entity.flow_date !== null ? formatDate(entity.flow_date)
													: "";
												var flowId = entity.flow_id !== null ? entity.flow_id
													: "";

												var flowCode = entity.flow_code !== null ? entity.flow_code
													: "";
												var flowAmount = entity.flow_amt !== null ? formatNumberWithCommas(entity.flow_amt)
													: "0.00";
												var acctNo = entity.loan_acct_no !== null ? entity.loan_acct_no
													: "";
												//var inst_pct = entity.inst_pct !== null ? entity.inst_pct : "";
												var acctName = entity.acct_name !== null ? entity.acct_name
													: "";


												tHTML += "<tr>"
													+ "<td><input type='text' name='flow_date' value='" + flowDate + "' class='border-0' readonly /></td>"
													+ "<td><input type='text' name='flow_id' value='" + flowId + "'  class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='flow_code' value='" + flowCode + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='flow_amt' value='" + flowAmount + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='loan_acct_no' value='" + acctNo + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='acct_name' value='" + acctName + "' class='border-0' readonly  /></td>"

													+ "<td><input type='radio' onclick='handleRadioClickCollection(this);' data-flow_code='"
													+ flowCode
													+ "' data-loan_acct_no='"
													+ acctNo
													+ "' data-flow_amt='"
													+ flowAmount
													+ "' data-acct_name='" + acctName
													+ "' data-flow_date='" + flowDate
													+ "' data-flow_id='" + flowId
													+ "' data-operation='" + operationType
													+ "' name='und_pct_radio' /></td>"

													+ "</tr>";
											});
								} else {
									tHTML += "<tr><td colspan='7'>No records available</td></tr>";
								}
								$("#flowIdTbody").empty().append(tHTML);
							},
							error: function () {
								$('#errorMessage').text('Error fetching data');
								$('#errorModal').modal('show');
							}
						});

					} else {
						console.log("Deposit option is checked.");
						$("#acct_num2").removeClass("d-none");
						$("#acct_num1").addClass("d-none");
						$("#flowIdTable").removeClass("d-none");
						$("#fromtovalues").removeClass("d-none");
						$("#operationtype").removeClass("d-none");
						$("#serviceflowIdTable").addClass("d-none");
						$("#repaymentTypeDiv").addClass("d-none");
						
						var acct_num = $("#acct_num2").val();
						$.ajax({
							type: 'GET',
							url: './depositflowDetails',
							data: {
								fromDate: dateFrom,
								todate: DateTo,
								accountNumber: acct_num
							},
							success: function (data) {
								console.log(data);

								var tHTML = "";

								if (data.length > 0) {
									$.each(data, function (index, entity) {

										var flowDate = entity.flow_date !== null ? formatDate(entity.flow_date) : "";
										var flowId = entity.flow_id !== null ? entity.flow_id : "";
										var flowCode = entity.flow_code !== null ? entity.flow_code : "";
										var flowAmount = entity.flow_amt !== null ? formatNumberWithCommas(entity.flow_amt) : "0.00";
										var acctNo = entity.loan_acct_no !== null ? entity.acid : "";

										// Fetch account name for each account number
										$.ajax({
											type: 'GET',
											url: './depositAcctName',
											data: {
												acctNo: acctNo
											},
											success: function (acctNameData) {
												console.log("Account Name: " + acctNameData);
												var acctName = acctNameData.trim(); // Assign the returned account name

												// Now append the row once we have the account name
												tHTML += "<tr>"
													+ "<td><input type='text' name='flow_date' value='" + flowDate + "' class='border-0' readonly /></td>"
													+ "<td><input type='text' name='flow_id' value='" + flowId + "'  class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='flow_code' value='" + flowCode + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='flow_amt' value='" + flowAmount + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='loan_acct_no' value='" + acctNo + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='acct_name' value='" + acctName + "' class='border-0' readonly  /></td>"
													+ "<td><input type='radio' onclick='handleRadioClickCollection(this);' data-flow_code='"
													+ flowCode
													+ "' data-loan_acct_no='" + acctNo
													+ "' data-flow_amt='" + flowAmount
													+ "' data-acct_name='" + acctName
													+ "' data-flow_date='" + flowDate
													+ "' data-flow_id='" + flowId
													+ "' data-operation='" + operationType
													+ "' name='und_pct_radio' /></td>"
													+ "</tr>";

												// Append after each row creation
												$("#flowIdTbody").empty().append(tHTML);

											},
											error: function () {
												$('#errorMessage').text('Error fetching account name');
												$('#errorModal').modal('show');
											}
										});
									});
								} else {
									tHTML += "<tr><td colspan='7'>No records available</td></tr>";
									$("#flowIdTbody").empty().append(tHTML);
								}
							},
							error: function () {
								$('#errorMessage').text('Error fetching data');
								$('#errorModal').modal('show');
							}
						});



					}

				} else if ($('#officeRouting').is(':checked')) {

					var operationType = "CollectionRouting";

					console.log("officeRouting option is checked.");
					$("#serviceChargesTypeDiv").addClass("d-none");
					$("#flowIdTable").removeClass("d-none");
					$("#fromtovalues").removeClass("d-none");
					$("#operationtype").removeClass("d-none");
					$("#serviceflowIdTable").addClass("d-none");
					$("#repaymentTypeDiv").addClass("d-none");

					if ($('#loan').is(':checked')) {
						console.log("Loan option is checked.");
						$("#acct_num1").removeClass("d-none");
						$("#acct_num2").addClass("d-none");
						var acct_num = $("#acct_num1").val();
						$.ajax({
							type: 'GET',
							url: './loanflowDetails1',
							data: {
								fromDate: dateFrom,
								todate: DateTo,
								accountNumber: acct_num
							},
							success: function (data) {
								console.log(data);

								var tHTML = "";
								if (data.length > 0) {
									$
										.each(
											data,
											function (index, entity) {


												var flowDate = entity.flow_date !== null ? formatDate(entity.flow_date)
													: "";
												var flowId = entity.flow_id !== null ? entity.flow_id
													: "";

												var flowCode = entity.flow_code !== null ? entity.flow_code
													: "";
												var flowAmount = entity.flow_amt !== null ? formatNumberWithCommas(entity.flow_amt)
													: "0.00";
												var acctNo = entity.loan_acct_no !== null ? entity.loan_acct_no
													: "";
												//var inst_pct = entity.inst_pct !== null ? entity.inst_pct : "";
												var acctName = entity.acct_name !== null ? entity.acct_name
													: "";


												tHTML += "<tr>"
													+ "<td><input type='text' name='flow_date' value='" + flowDate + "' class='border-0' readonly /></td>"
													+ "<td><input type='text' name='flow_id' value='" + flowId + "'  class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='flow_code' value='" + flowCode + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='flow_amt' value='" + flowAmount + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='loan_acct_no' value='" + acctNo + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='acct_name' value='" + acctName + "' class='border-0' readonly  /></td>"

													+ "<td><input type='radio' onclick='handleRadioClickCollection(this);' data-flow_code='"
													+ flowCode
													+ "' data-loan_acct_no='"
													+ acctNo
													+ "' data-flow_amt='"
													+ flowAmount
													+ "' data-acct_name='" + acctName
													+ "' data-flow_date='" + flowDate
													+ "' data-flow_id='" + flowId
													+ "' data-operation='" + operationType
													+ "' name='und_pct_radio' /></td>"

													+ "</tr>";
											});
								} else {
									tHTML += "<tr><td colspan='7'>No records available</td></tr>";
								}
								$("#flowIdTbody").empty().append(tHTML);
							},
							error: function () {
								$('#errorMessage').text('Error fetching data');
								$('#errorModal').modal('show');
							}
						});

					} else {
						console.log("Deposit option is checked.");
						$("#acct_num2").removeClass("d-none");
						$("#acct_num1").addClass("d-none");
						$("#flowIdTable").removeClass("d-none");
						$("#fromtovalues").removeClass("d-none");
						$("#operationtype").removeClass("d-none");
						$("#serviceflowIdTable").addClass("d-none");
						$("#repaymentTypeDiv").addClass("d-none");
						var acct_num = $("#acct_num2").val();
						$.ajax({
							type: 'GET',
							url: './depositflowDetails',
							data: {
								fromDate: dateFrom,
								todate: DateTo,
								accountNumber: acct_num
							},
							success: function (data) {
								console.log(data);

								var tHTML = "";

								if (data.length > 0) {
									$.each(data, function (index, entity) {

										var flowDate = entity.flow_date !== null ? formatDate(entity.flow_date) : "";
										var flowId = entity.flow_id !== null ? entity.flow_id : "";
										var flowCode = entity.flow_code !== null ? entity.flow_code : "";
										var flowAmount = entity.flow_amt !== null ? formatNumberWithCommas(entity.flow_amt) : "0.00";
										var acctNo = entity.loan_acct_no !== null ? entity.acid : "";

										// Fetch account name for each account number
										$.ajax({
											type: 'GET',
											url: './depositAcctName',
											data: {
												acctNo: acctNo
											},
											success: function (acctNameData) {
												console.log("Account Name: " + acctNameData);
												var acctName = acctNameData.trim(); // Assign the returned account name

												// Now append the row once we have the account name
												tHTML += "<tr>"
													+ "<td><input type='text' name='flow_date' value='" + flowDate + "' class='border-0' readonly /></td>"
													+ "<td><input type='text' name='flow_id' value='" + flowId + "'  class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='flow_code' value='" + flowCode + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='flow_amt' value='" + flowAmount + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='loan_acct_no' value='" + acctNo + "' class='border-0' readonly  /></td>"
													+ "<td><input type='text' name='acct_name' value='" + acctName + "' class='border-0' readonly  /></td>"
													+ "<td><input type='radio' onclick='handleRadioClickCollection(this);' data-flow_code='"
													+ flowCode
													+ "' data-loan_acct_no='" + acctNo
													+ "' data-flow_amt='" + flowAmount
													+ "' data-acct_name='" + acctName
													+ "' data-flow_date='" + flowDate
													+ "' data-flow_id='" + flowId
													+ "' data-operation='" + operationType
													+ "' name='und_pct_radio' /></td>"
													+ "</tr>";

												// Append after each row creation
												$("#flowIdTbody").empty().append(tHTML);

											},
											error: function () {
												$('#errorMessage').text('Error fetching account name');
												$('#errorModal').modal('show');
											}
										});
									});
								} else {
									tHTML += "<tr><td colspan='7'>No records available</td></tr>";
									$("#flowIdTbody").empty().append(tHTML);
								}
							},
							error: function () {
								$('#errorMessage').text('Error fetching data');
								$('#errorModal').modal('show');
							}
						});



					}

				}
			}
			else if ($('#repayment').is(':checked')) {
				console.log("repayment option is checked.");
				$("#repaymentTypeDiv").removeClass("d-none");
				$("#collectionTypeDiv").addClass("d-none");
				$("#flowIdTable").addClass("d-none");
				$("#fromtovalues").addClass("d-none");
				$("#operationtype").addClass("d-none");
				$("#serviceflowIdTable").addClass("d-none");
				$("#acct_num11").addClass("d-none");
				
				
			}
			else if ($('#booking').is(':checked')) {
				console.log("Collection option is checked.");

				$("#collectionTypeDiv").addClass("d-none");
				$("#serviceChargesTypeDiv").addClass("d-none");
				$("#flowIdTable").removeClass("d-none");
				$("#fromtovalues").removeClass("d-none");
				$("#operationtype").removeClass("d-none");
				$("#serviceflowIdTable").addClass("d-none");
				$("#repaymentTypeDiv").addClass("d-none");

				var operationType = "Booking";

				if ($('#loan').is(':checked')) {
					console.log("Loan option is checked.");

					$("#acct_num1").removeClass("d-none");
					$("#acct_num2").addClass("d-none");
					var actno1 = document.getElementById('acct_num1').value;

					$.ajax({
						type: 'GET',
						url: './FlowForDateloan',
						data: {
							actno1: actno1,
							dateFrom: dateFrom

						},
						success: function (data) {
							console.log(data);

							var tHTML = "";

							var flowDate = data.flow_date !== null ? formatDate(data.flow_date)
								: "";
							var flowId = data.flow_id !== null ? data.flow_id
								: "";

							var flowCode = data.flow_code !== null ? data.flow_code
								: "";
							var flowAmount = data.flow_amt !== null ? formatNumberWithCommas(data.flow_amt)
								: "0.00";
							var acctNo = data.loan_acct_no !== null ? data.loan_acct_no
								: "";
							//var inst_pct = entity.inst_pct !== null ? entity.inst_pct : "";
							var acctName = data.acct_name !== null ? data.acct_name
								: "";
							var intamt = data.tran_amt !== null ? data.tran_amt : "0.00";
							var days = data.part_tran_id !== null ? data.part_tran_id : "0";

							tHTML += "<tr>"
								+ "<td><input type='text' name='flow_date' value='" + flowDate + "' class='border-0' readonly /></td>"
								+ "<td><input type='text' name='flow_id' value='" + flowId + "'  class='border-0' readonly  /></td>"
								+ "<td><input type='text' name='flow_code' value='" + flowCode + "' class='border-0' readonly  /></td>"
								+ "<td><input type='text' name='flow_amt' value='" + flowAmount + "' class='border-0' readonly  /></td>"
								+ "<td><input type='text' name='loan_acct_no' value='" + acctNo + "' class='border-0' readonly  /></td>"
								+ "<td><input type='text' name='acct_name' value='" + acctName + "' class='border-0' readonly  /></td>"

								+ "<td><input type='radio' onclick='handleRadioClickBooking(this);' data-flow_code='"
								+ flowCode
								+ "' data-loan_acct_no='"
								+ acctNo
								+ "' data-flow_amt='"
								+ flowAmount
								+ "' data-acct_name='" + acctName
								+ "' data-flow_date='" + flowDate
								+ "' data-flow_id='" + flowId
								+ "' data-operation='" + operationType
								+ "' data-interest='" + intamt
								+ "' data-days='" + days
								+ "' name='und_pct_radio' /></td>"

								+ "</tr>";


							$("#flowIdTbody").empty().append(tHTML);
						},
						error: function () {
							$('#errorMessage').text('Error fetching data');
							$('#errorModal').modal('show');
						}
					});

				} else {
					console.log("Deposit option is checked.");
					$("#acct_num2").removeClass("d-none");
					$("#acct_num1").addClass("d-none");
					$("#flowIdTable").removeClass("d-none");
					$("#fromtovalues").removeClass("d-none");
					$("#operationtype").removeClass("d-none");
					$("#serviceflowIdTable").addClass("d-none");
					$("#repaymentTypeDiv").addClass("d-none");
					var actno2 = document.getElementById('acct_num2').value;

					$.ajax({
						type: 'GET',
						url: './FlowForDate',
						data: {
							actno2: actno2,
							dateFrom: dateFrom
						},
						success: function (data) {
							console.log(data);

							var tHTML = "";




							var flowDate = data.flow_date !== null ? formatDate(data.flow_date) : "";
							var flowId = data.flow_id !== null ? data.flow_id : "";
							var flowCode = data.flow_code !== null ? data.flow_code : "";
							var flowAmount = data.flow_amt !== null ? formatNumberWithCommas(data.flow_amt) : "0.00";
							var acctNo = data.loan_acct_no !== null ? data.acid : "";
							var intamt = data.tran_amt !== null ? data.tran_amt : "0.00";
							var days = data.residual_bal !== null ? data.residual_bal : "0";

							// Fetch account name for each account number
							$.ajax({
								type: 'GET',
								url: './depositAcctName',
								data: {
									acctNo: acctNo
								},
								success: function (acctNameData) {
									console.log("Account Name: " + acctNameData);
									var acctName = acctNameData.trim(); // Assign the returned account name

									// Now append the row once we have the account name
									tHTML += "<tr>"
										+ "<td><input type='text' name='flow_date' value='" + flowDate + "' class='border-0' readonly /></td>"
										+ "<td><input type='text' name='flow_id' value='" + flowId + "'  class='border-0' readonly  /></td>"
										+ "<td><input type='text' name='flow_code' value='" + flowCode + "' class='border-0' readonly  /></td>"
										+ "<td><input type='text' name='flow_amt' value='" + flowAmount + "' class='border-0' readonly  /></td>"
										+ "<td><input type='text' name='loan_acct_no' value='" + acctNo + "' class='border-0' readonly  /></td>"
										+ "<td><input type='text' name='acct_name' value='" + acctName + "' class='border-0' readonly  /></td>"
										+ "<td><input type='radio' onclick='handleRadioClickBooking(this);' data-flow_code='"
										+ flowCode
										+ "' data-loan_acct_no='" + acctNo
										+ "' data-flow_amt='" + flowAmount
										+ "' data-acct_name='" + acctName
										+ "' data-flow_date='" + flowDate
										+ "' data-flow_id='" + flowId
										+ "' data-operation='" + operationType
										+ "' data-interest='" + intamt
										+ "' data-days='" + days
										+ "' name='und_pct_radio' /></td>"
										+ "</tr>";

									// Append after each row creation
									$("#flowIdTbody").empty().append(tHTML);

								},
								error: function () {
									$('#errorMessage').text('Error fetching account name');
									$('#errorModal').modal('show');
								}
							});


						},
						error: function () {
							$('#errorMessage').text('Error fetching data');
							$('#errorModal').modal('show');
						}
					});



				}

			}

			else {
				console.log("Interest option is not checked.");

			}

		}

		function handleRadioClickInterest(selectedRadio) {
			var flow_amt = selectedRadio.getAttribute("data-flow_amt").replace(/,/g, '');
			var flow_code = selectedRadio.getAttribute("data-flow_code");
			var flow_id = selectedRadio.getAttribute("data-flow_id");
			var flow_date = selectedRadio.getAttribute("data-flow_date");
			var loan_acct_no = selectedRadio.getAttribute("data-loan_acct_no");
			var acct_name = selectedRadio.getAttribute("data-acct_name");
			var operation = selectedRadio.getAttribute("data-operation");

			console.log(flow_amt + " " + flow_code + " " + loan_acct_no + " " + acct_name + " " + flow_date);


			$.ajax({
				type: 'GET',
				url: './transactionInterest',
				data: {
					flow_amount: flow_amt,
					flow_code: flow_code,
					flow_date: flow_date,
					account_no: loan_acct_no,
					accountName: acct_name,
					flow_id: flow_id,
					operation: operation


				},
				success: function (data) {
					console.log(data);

					var tranId = data.trim();
					var parttranid = "1";


					var url = 'accountLedgerPost?formmode=verify' +
						'&acct_num=' + encodeURIComponent(loan_acct_no) +
						'&tran_id=' + encodeURIComponent(tranId) +
						'&part_tran_id=' + encodeURIComponent(parttranid);  // Include tranId in the URL

					// Redirect to the constructed URL
					location.href = url;



				},
				error: function () {
					$('#errorMessage').text('Error fetching data');
					$('#errorModal').modal('show');
				}
			});
		}
		
		
		function handleRadioClickInterestdatas(selectedRadio) {
		    // Get the parent row of the selected radio button
		    var row = selectedRadio.closest("tr");

		    // Fetch values dynamically from input fields within the same row
		    var flow_amt = row.querySelector("[name='flow_amt']").value.trim();
		    var flow_code = row.querySelector("[name='flow_code']").value.trim();
		    var flow_id = row.querySelector("[name='flow_id']").value.trim();
		    var flow_date = row.querySelector("[name='flow_date']").value.trim();
		    var loan_acct_no = row.querySelector("[name='loan_acct_no']").value.trim();
		    var acct_name = row.querySelector("[name='acct_name']").value.trim();

		    // Convert flow_date from "YYYY-MM-DD" to "DD-MM-YYYY"
		    if (flow_date) {
		        let dateParts = flow_date.split("-");
		        flow_date = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;  // Rearranging to DD-MM-YYYY
		    }

		    // Debugging alert
		    alert("Flow Amount: " + flow_amt + 
		          "\nFlow Code: " + flow_code + 
		          "\nFlow ID: " + flow_id + 
		          "\nFlow Date (Converted): " + flow_date + 
		          "\nLoan Account No: " + loan_acct_no + 
		          "\nAccount Name: " + acct_name);

		    // AJAX Request
		    $.ajax({
		        type: 'GET',
		        url: './transactionInterest',
		        data: {
		            flow_amount: flow_amt,
		            flow_code: flow_code,
		            flow_date: flow_date,
		            account_no: loan_acct_no,
		            accountName: acct_name,
		            flow_id: flow_id
		        },
		        success: function (data) {
		            console.log(data);
		            var tranId = data.trim();
		            var parttranid = "1";

		            var url = 'accountLedgerPost?formmode=verify' +
		                '&acct_num=' + encodeURIComponent(loan_acct_no) +
		                '&tran_id=' + encodeURIComponent(tranId) +
		                '&part_tran_id=' + encodeURIComponent(parttranid);

		            // Redirect to the constructed URL
		            location.href = url;
		        },
		        error: function () {
		            $('#errorMessage').text('Error fetching data');
		            $('#errorModal').modal('show');
		        }
		    });
		}

		function handleRadioClickCollection(selectedRadio) {
			var flow_amt = selectedRadio.getAttribute("data-flow_amt").replace(/,/g, '');
			var flow_code = selectedRadio.getAttribute("data-flow_code");
			var flow_id = selectedRadio.getAttribute("data-flow_id");
			var flow_date = selectedRadio.getAttribute("data-flow_date");
			var loan_acct_no = selectedRadio.getAttribute("data-loan_acct_no");
			var acct_name = selectedRadio.getAttribute("data-acct_name");
			var operation = selectedRadio.getAttribute("data-operation");

			console.log(flow_amt + " " + flow_id + " " + flow_code + " " + loan_acct_no + " " + acct_name + " " + flow_date + " " + operation);

			$.ajax({
				type: 'GET',
				url: './transactionCollection',
				data: {
					flow_amount: flow_amt,
					flow_code: flow_code,
					flow_date: flow_date,
					account_no: loan_acct_no,
					accountName: acct_name,
					flow_id: flow_id,
					operation: operation


				},
				success: function (data) {
					console.log(data);

					var tranId = data.trim();
					var parttranid = "1";


					var url = 'accountLedgerPost?formmode=verify' +
						'&acct_num=' + encodeURIComponent(loan_acct_no) +
						'&tran_id=' + encodeURIComponent(tranId) +
						'&part_tran_id=' + encodeURIComponent(parttranid);  // Include tranId in the URL

					// Redirect to the constructed URL
					location.href = url;



				},
				error: function () {
					$('#errorMessage').text('Error fetching data');
					$('#errorModal').modal('show');
				}
			});
		}

		function handleRadioClickBooking(selectedRadio) {
			var flow_amt = selectedRadio.getAttribute("data-flow_amt").replace(/,/g, '');
			var flow_code = selectedRadio.getAttribute("data-flow_code");
			var flow_id = selectedRadio.getAttribute("data-flow_id");
			var flow_date = selectedRadio.getAttribute("data-flow_date");
			var loan_acct_no = selectedRadio.getAttribute("data-loan_acct_no");
			var acct_name = selectedRadio.getAttribute("data-acct_name");
			var operation = selectedRadio.getAttribute("data-operation");
			var interest = selectedRadio.getAttribute("data-interest");
			var days = selectedRadio.getAttribute("data-days");

			console.log(flow_amt + " " + flow_code + " " + loan_acct_no + " " + acct_name + " " + flow_date);


			$.ajax({
				type: 'GET',
				url: './transactionBooking',
				data: {
					flow_amount: flow_amt,
					flow_code: flow_code,
					flow_date: flow_date,
					account_no: loan_acct_no,
					accountName: acct_name,
					flow_id: flow_id,
					operation: operation,
					interest: interest,
					days: days


				},
				success: function (data) {
					console.log(data);

					var array = data.split(',');

					var tranId = array[0].trim();
					var ActNo = array[1].trim();
					var parttranid = "1";


					var url = 'accountLedgerPost?formmode=verify' +
						'&acct_num=' + encodeURIComponent(ActNo) +
						'&tran_id=' + encodeURIComponent(tranId) +
						'&part_tran_id=' + encodeURIComponent(parttranid);  // Include tranId in the URL

					// Redirect to the constructed URL
					location.href = url;



				},
				error: function () {
					$('#errorMessage').text('Error fetching data');
					$('#errorModal').modal('show');
				}
			});
		}

		function formatDateToDD(dateString) {

			var parts = dateString.split('-');

			return parts[2] + '-' + parts[1] + '-' + parts[0];
		}

		function formatNumberWithCommas(number) {

			if (!number && number !== 0) return '';
			console.log("number : " + number);
			let numberString = number.toString();
			console.log("numberString : " + numberString);

			let [integerPart, decimalPart] = numberString.split('.');

			let lastThreeDigits = integerPart.slice(-3);
			let otherDigits = integerPart.slice(0, -3);

			if (otherDigits !== '') {
				lastThreeDigits = ',' + lastThreeDigits;
			}

			let formattedIntegerPart = otherDigits.replace(/\B(?=(\d{2})+(?!\d))/g, ',') + lastThreeDigits;

			if (!decimalPart) {
				decimalPart = '00';
			}
			let formattedNumber = formattedIntegerPart + '.' + decimalPart;
			console.log("formattedIntegerPart : " + formattedIntegerPart);
			console.log("decimalPart : " + decimalPart);

			return formattedNumber;
		}

		function formatDate(dateString) {

			var date = new Date(dateString);


			var day = date.getDate();
			var month = date.getMonth() + 1;
			var year = date.getFullYear();


			if (day < 10) {
				day = '0' + day;
			}
			if (month < 10) {
				month = '0' + month;
			}

			return day + '-' + month + '-' + year;
		}
	</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let today = new Date().toISOString().split('T')[0]; // Get current date in YYYY-MM-DD format
        document.getElementById("flowDateInput").value = today; // Set default value
    });
</script>
<script th:inline="javascript">

		/* <![CDATA[ */
		// Convert the Thymeleaf variable to a JavaScript date
		var trandate = /*[[${TRANDATE}]]*/'1970-01-01';

		// Function to format date as yyyy-MM-dd
		function formatForInput(date) {
			var d = new Date(date);
			var day = ('0' + d.getDate()).slice(-2);
			var month = ('0' + (d.getMonth() + 1)).slice(-2);
			var year = d.getFullYear();
			return `${year}-${month}-${day}`;
		}

		// Function to format date as dd-MM-yyyy
		function formatDatedd(date) {
			var d = new Date(date);
			var day = ('0' + d.getDate()).slice(-2);
			var month = ('0' + (d.getMonth() + 1)).slice(-2);
			var year = d.getFullYear();
			return `${day}-${month}-${year}`;
		}
		
		document.addEventListener("DOMContentLoaded", function () {
			// Get today's date

			const formattedDate = formatDatedd(trandate);

			// Display today's date in dd-mm-yyyy format
			document.getElementById('fromdate').value = formattedDate;
			document.getElementById('todate').value = formattedDate;

			document.getElementById('interest').checked = true;
			document.getElementById('loan').checked = true;
			document.getElementById('officeRouting').checked = true;




			getflowDetails();
		});

		
		/* ]]> */
		


	</script>
<script>
function updateAccountName(selectElement) {
    var selectedOption = selectElement.options[selectElement.selectedIndex];

    console.log("Selected Option HTML:", selectedOption.outerHTML); // Debugging step

    // Retrieve account name using correct attribute
    var accountName = selectedOption.getAttribute("data-acct-namevalues") || "";

    console.log("Retrieved Account Name (data-acct-name):", accountName); // Debugging output

    // Update account name input field
    document.getElementById("acct_name").value = accountName;
}

function updateAccountName1(selectElement) {
    var selectedOption = selectElement.options[selectElement.selectedIndex];

    console.log("Selected Option HTML:", selectedOption.outerHTML); // Debugging step

    // Retrieve account name using correct attribute
    var accountName = selectedOption.getAttribute("data-acct-namevalues") || "";

    console.log("Retrieved Account Name (data-acct-name):", accountName); // Debugging output

    // Update account name input field
    document.getElementById("acct_name1").value = accountName;
}

function handleCheckboxClickCollectiondata() {
    // Show confirmation modal before proceeding
    $('#confirmation_modal').modal('show');

    // Handle the "Yes" button click to proceed
    $('#confirmYesBtn').off('click').on('click', function () {
        proceedWithTransaction();
    });

    // Handle the "No" button click to refresh the page
    $('#confirmNoBtn').off('click').on('click', function () {
        location.reload(); // Refresh the current page
    });
}

function proceedWithTransaction() {
    var loanBal = parseFloat(document.getElementById("loan_bal").value.replace(/,/g, '')) || 0;
    var acctBalance = parseFloat(document.getElementById("acct_balancedatas").value.replace(/,/g, '')) || 0;

    alert("THE LOAN ACCOUNT BALANCE IS " + loanBal);
    alert("THE PRECLOSURE ACCOUNT BALANCE IS " + acctBalance);

    var selectedData = [];

    $("#flowIdTbodynew tr").each(function () {
        var row = $(this);
        let flowAmt = row.find("input[name='flow_amt']").val() || row.find("input[name='flow_amtvals']").val();

        if (!flowAmt) return true; // Skip row if no amount

        let selectedRadio = row.find("input[type='radio']:checked").val() || "None";

        let rowData = {
            flow_amt: flowAmt.replace(/,/g, ''),
            flow_code: row.find("input[name='flow_code']").val() || '',
            flow_date: row.find("input[name='flow_date']").val() || '',
            flow_id: row.find("input[name='flow_id']").val() || '',
            loan_acct_no: row.find("input[name='loan_acct_no']").val() || '',
            acct_name: row.find("input[name='acct_name']").val() || '',
            selected_option: selectedRadio
        };

        selectedData.push(rowData); // âœ… Properly pushing to selectedData
    });

    if (selectedData.length === 0) {
        alert("No data found.");
        return;
    }

    console.log("Loan Balance:", loanBal);
    console.log("Preclosure Balance:", acctBalance);
    console.log("Comparison Result:", Math.abs(loanBal) === Math.abs(acctBalance));

    // Compare absolute values and send data to correct endpoint
    if (Math.abs(loanBal) === Math.abs(acctBalance)) {
        processTransaction('./transactionCollectiondatas121', selectedData);
    } else {
        processTransaction('./transactionCollectiondatas1211', selectedData);
    }
}

function processTransaction(url, selectedData) {
    $.ajax({
        type: 'POST',
        url: url,
        contentType: 'application/json',
        data: JSON.stringify(selectedData),
        success: function (data) {
            console.log("Server response:", data);
            var tranId = data.trim();
            var redirectUrl = 'accountLedgerPost?formmode=verify' +
                '&acct_num=' + encodeURIComponent(selectedData[0].loan_acct_no) +
                '&tran_id=' + encodeURIComponent(tranId) +
                '&part_tran_id=1';
            location.href = redirectUrl;
        },
        error: function () {
            $('#errorMessage').text('Error fetching data');
            $('#errorModal').modal('show');
        }
    });
}

function handleCheckboxClickCollectiondata1() {
    // Show confirmation modal before proceeding
    $('#confirmation_modal').modal('show');

    // Handle "Yes" button click to proceed
    $('#confirmYesBtn').off('click').on('click', function () {
        proceedWithTransaction1();
    });

    // Handle "No" button click to refresh the page
    $('#confirmNoBtn').off('click').on('click', function () {
        location.reload(); // Refresh the page
    });
}

function proceedWithTransaction1() {
    var loanBal = parseFloat(document.getElementById("loan_bal1").value.replace(/,/g, '')) || 0;
    var acctBalance = parseFloat(document.getElementById("acct_balancedatas1").value.replace(/,/g, '')) || 0;

    var processRows = [];

    $("#flowIdTbodynew1 tr").each(function () {
        var row = $(this);
        let flowAmt = row.find("input[name='flow_amt']").val() || row.find("input[name='flow_amtvals1']").val();

        if (!flowAmt) return true; // Skip row if no amount

        let selectedRadio = row.find("input[type='radio']:checked").val() || "None";

        let rowData = {
            flow_amt: flowAmt.replace(/,/g, ''), // Remove commas
            flow_code: row.find("input[name='flow_code']").val() || '',
            flow_date: row.find("input[name='flow_date']").val() || '',
            flow_id: row.find("input[name='flow_id']").val() || '',
            loan_acct_no: row.find("input[name='loan_acct_no']").val() || '',
            acct_name: row.find("input[name='acct_name']").val() || '',
            selected_option: selectedRadio
        };

        processRows.push(rowData);
    });

    if (processRows.length === 0) {
        alert("No rows to process.");
        return;
    }

    console.log("Loan Balance:", loanBal);
    console.log("Preclosure Balance:", acctBalance);
    console.log("Comparison Result:", Math.abs(loanBal) === Math.abs(acctBalance));

    if (Math.abs(loanBal) === Math.abs(acctBalance)) {
        processTransaction1('./transactionCollectiondatas1212', processRows);
    } else {
        processTransaction1('./transactionCollectiondatas1221', processRows);
    }
}

// Function to handle AJAX transaction request
function processTransaction1(url, selectedData) {
    $.ajax({
        type: 'POST',
        url: url,
        contentType: 'application/json',
        data: JSON.stringify(selectedData),
        success: function (data) {
            console.log("Server response:", data);
            var tranId = data.trim();
            var parttranid = "1";
            var redirectUrl = 'accountLedgerPost?formmode=verify' +
                '&acct_num=' + encodeURIComponent(selectedData[0].loan_acct_no) +
                '&tran_id=' + encodeURIComponent(tranId) +
                '&part_tran_id=' + encodeURIComponent(parttranid);
            location.href = redirectUrl;
        },
        error: function () {
            $('#errorMessage').text('Error fetching data');
            $('#errorModal').modal('show');
        }
    });
}


function fetchacctnum() {
    var acctnum = document.getElementById("acct_num1234").value;
  
    // Fetch the updated account name directly from the select field
    var selectedOption = document.getElementById("acct_num1234").options[document.getElementById("acct_num1234").selectedIndex];
    var acctName = selectedOption.getAttribute("data-acct-name") || ""; // Correctly fetching from the selected option

    console.log("Account No:", acctnum);
    console.log("Updated Account Name (From Select Option):", acctName);

    $.ajax({
        type: 'GET',
        url: './fetchacctbalance',
        data: { acctnum: acctnum },
        success: function (data) {
            console.log("Raw Account Balance:", data);

            var formattedBalance = parseFloat(data).toLocaleString('en-US', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            });

            document.getElementById("loan_bal").value = formattedBalance;
            // âœ… REMOVE 'display: none;' to make sections visible
            document.getElementById("repaymentschedule").style.removeProperty("display");
            document.getElementById("ledgerschedule").style.removeProperty("display");

            // Second AJAX request using updated account name
            $.ajax({
                type: 'GET',
                url: './getloanclosetdatas51',
                data: { accountNumber: acctnum }, // âœ… Passing the correct value
                success: function (data) {
                    console.log("Received Data:", data);
                    
                    // Extract total amount safely
                    var flow_total_amt = data.flow_total_amt ? data.flow_total_amt : "0.00";
                    console.log("Total Amount:", flow_total_amt); // âœ… Total amount
                    console.log("Loan Flows:", data.loan_flows); // âœ… List of loan flow details

                    // Format total amount as decimal (2 decimal places with commas)
                    var formattedTotalAmount = parseFloat(flow_total_amt).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                    
                    // Set total amount to an input field
                    document.getElementById("acct_balancedatas").value = formattedTotalAmount;
                    
                    var tHTML = "";
                    
                    // âœ… Corrected loop to iterate over data.loan_flows
                    if (data.loan_flows && data.loan_flows.length > 0) {
                        $.each(data.loan_flows, function (index, entity) { // âœ… Iterate over `loan_flows`
                            var flowDate = entity.flow_date !== null ? formatDate(entity.flow_date) : "";
                            var flowId = entity.flow_id !== null ? entity.flow_id : "";
                            var flowCode = entity.flow_code !== null ? entity.flow_code : "";
                            var flowAmount = entity.flow_amt !== null ? formatNumberWithCommas(entity.flow_amt) : "0.00";
                            var acctNo = entity.loan_acct_no !== null ? entity.loan_acct_no : "";
                            var acctName = entity.acct_name !== null ? entity.acct_name : "";

                            tHTML += "<tr>"
                                + "<td><input type='text' name='flow_date' value='" + flowDate + "' class='border-0' readonly /></td>"
                                + "<td><input type='text' name='flow_id' value='" + flowId + "' class='border-0' readonly /></td>"
                                + "<td><input type='text' name='flow_code' value='" + flowCode + "' class='border-0' readonly /></td>"
                                + "<td style='text-align: right;'><input type='text' name='flow_amt' value='" + flowAmount + "' class='border-0 text-right' readonly /></td>"
                                + "<td><input type='text' name='loan_acct_no' value='" + acctNo + "' class='border-0' readonly /></td>"
                                + "<td><input type='text' name='acct_name' value='" + acctName + "' class='border-0' readonly /></td>"
                                + "<td><input type='radio' onclick='handleCheckboxClickCollectiondata(this);' data-flow_code='"
                                + flowCode
                                + "' data-loan_acct_no='"
                                + acctNo
                                + "' data-flow_amt='"
                                + flowAmount
                                + "' data-acct_name='" + acctName
                                + "' data-flow_date='" + flowDate
                                + "' data-flow_id='" + flowId
                                + "' name='und_pct_radio' /></td>"
                                + "</tr>";
                        });
                    } else {
                        tHTML = "<tr><td colspan='7'>No records available</td></tr>";
                    }
                    
                    // âœ… Ensure table body is correctly updated
                    $("#flowIdTbodynew").empty().append(tHTML);
                },
                error: function () {
                    $('#errorMessage').text('Error fetching data');
                    $('#errorModal').modal('show');
                }
            });

        },
        error: function (xhr, status, error) {
            console.error("Error fetching balance:", error);
            document.getElementById("loan_bal").value = "";
        }
    });
}

function fetchacctnum1() {
    var acctnum = document.getElementById("acct_num123456").value;
    var selectedOption = document.getElementById("acct_num123456").options[document.getElementById("acct_num123456").selectedIndex];
    var acctName = selectedOption.getAttribute("data-acct-name") || "";

    $.ajax({
        type: 'GET',
        url: './fetchacctbalance',
        data: { acctnum: acctnum },
        success: function (data) {
            var formattedBalance = parseFloat(data).toLocaleString('en-US', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            });

            document.getElementById("loan_bal1").value = formattedBalance;
            document.getElementById("repaymentschedule").style.removeProperty("display");
            document.getElementById("ledgerschedule").style.removeProperty("display");

            $.ajax({
                type: 'GET',
                url: './getloanclosetdatas521',
                data: { accountNumber: acctnum },
                success: function (data) {
                    var formattedTotalAmount = parseFloat(data.flow_total_amt || "0.00").toLocaleString('en-US', { 
                        minimumFractionDigits: 2, 
                        maximumFractionDigits: 2 
                    });

                    document.getElementById("acct_balancedatas1").value = formattedTotalAmount;

                    let tHTML = "";
                    let tranDate = data.tran_date ? formatDate(data.tran_date) : "";

                    if (data.loan_flows && data.loan_flows.length > 0) {
                        $.each(data.loan_flows, function (index, entity) {
                            var flowDate = entity.flow_date ? formatDate(entity.flow_date) : "";
                            var flowCode = entity.flow_code || "";
                            var flowAmount = entity.flow_amt ? formatNumberWithCommas(entity.flow_amt) : "0.00";
                            var acctNo = entity.loan_acct_no || "";
                            var acctName = entity.acct_name || "";

                            var isEditable = (flowCode === "FEEDEM" && flowDate === tranDate);

                            tHTML += `
                                <tr>
                                    <td><input type='text' name='flow_date' value='${flowDate}' class='border-0' readonly /></td>
                                    <td><input type='text' name='flow_id' value='${entity.flow_id || ""}' class='border-0' readonly /></td>
                                    <td><input type='text' name='flow_code' value='${flowCode}' class='border-0' readonly /></td>
                                    <td style='text-align: right;'>
                                        ${isEditable
                                            ? `<input type='number' name='flow_amt' value='${flowAmount}' class='border text-right' onchange='updateFeeDemAmount(this)' />`
                                            : `<input type='text' name='flow_amt' value='${flowAmount}' class='border-0 text-right' readonly />`}
                                    </td>
                                    <td><input type='text' name='loan_acct_no' value='${acctNo}' class='border-0' readonly /></td>
                                    <td><input type='text' name='acct_name' value='${acctName}' class='border-0' readonly /></td>
                                    <td>
                                        <input type="radio" name="row_select" onclick="handleCheckboxClickCollectiondata1()" />
                                    </td>
                                </tr>`;
                        });
                    } else {
                        tHTML = "<tr><td colspan='7'>No records available</td></tr>";
                    }

                    $("#flowIdTbodynew1").empty().append(tHTML);
                },
                error: function () {
                    $('#errorMessage').text('Error fetching loan data');
                    $('#errorModal').modal('show');
                }
            });
        },
        error: function () {
            $('#errorMessage').text('Error fetching account balance');
            $('#errorModal').modal('show');
        }
    });
}

</script>
<script type="text/javascript">
//Function to add a new row

let flowCounter = 2; // Initialize flow_id starting from 2

function deleteloanRow() {
    let table = document.getElementById("flowIdTbodynew");

    // Ensure at least 2 rows remain
    if (table.getElementsByClassName("deletable-row").length <= 0) {
        alert("At least 1 dynamically added row must remain.");
        return;
    }

    // Find the last dynamically added row
    let rows = table.getElementsByClassName("deletable-row");
    if (rows.length > 0) {
        let lastRow = rows[rows.length - 1];

        // Get the amount from the deleted row
        let deletedAmountInput = lastRow.querySelector("input[name='flow_amtvals']");
        let deletedAmount = deletedAmountInput ? parseFloat(deletedAmountInput.value.replace(/,/g, "")) || 0 : 0;

        // Remove the row
        lastRow.remove();

        // Update balance after row removal
        updateBalanceAfterDeletion(deletedAmount);
    }
}

function deleteloanRow1() {
    let table = document.getElementById("flowIdTbodynew1");

    // Ensure at least 2 rows remain
    if (table.getElementsByClassName("deletable-row").length <= 0) {
        alert("At least 1 dynamically added row must remain.");
        return;
    }

    // Find the last dynamically added row
    let rows = table.getElementsByClassName("deletable-row");
    if (rows.length > 0) {
        let lastRow = rows[rows.length - 1];

        // Get the amount from the deleted row
        let deletedAmountInput = lastRow.querySelector("input[name='flow_amtvals1']");
        let deletedAmount = deletedAmountInput ? parseFloat(deletedAmountInput.value.replace(/,/g, "")) || 0 : 0;

        // Remove the row
        lastRow.remove();

        // Update balance after row removal
        updateBalanceAfterDeletion(deletedAmount);
    }
}

function updateBalanceAfterDeletion(deletedAmount) {
    let balanceElem = document.getElementById("acct_balancedatas1");

    if (!balanceElem) {
        console.error("Error: Balance field not found!");
        return;
    }

    // Get the original balance
    let currentBalance = parseFloat(balanceElem.value.replace(/,/g, "")) || 0;
    
    // Subtract the deleted amount
    let newBalance = currentBalance - deletedAmount;

    // Debugging log
    console.log("Deleted Amount:", deletedAmount);
    console.log("Updated Balance:", newBalance);

    // Update the balance field
    balanceElem.value = newBalance.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
}



function addloanRow() {
    var accountNumber = document.getElementById("acct_num1234").value;

    $.ajax({
        type: 'GET',
        url: './getloanclosetdatas511',
        data: { accountNumber: accountNumber }, 
        success: function (data) {
            let table = document.getElementById("flowIdTbodynew"); 

            let newRow = table.insertRow();
            newRow.classList.add("deletable-row"); 

            newRow.innerHTML = `
                <td><input type="text" name="flow_date" class="border-0" value="${data.tran_date || ''}" readonly></td>
                <td><input type="text" name="flow_id" value="${flowCounter}" class="border-0" readonly /></td>
                <td><input type="text" name="flow_code" value="FEEDEM" class="border-0" readonly /></td>
                <td style="text-align:right;">
                    <input type="text" name="flow_amtvals" class="border-0 text-right" />
                </td>
                <td><input type="text" name="loan_acct_no" class="border-0" value="${data.loan_data.loan_acct_no}" readonly /></td>
                <td><input type="text" name="acct_name" class="border-0" value="${data.loan_data.acct_name}" readonly /></td>
                <td>
                    <input type="radio" name="row_select" onclick="handleCheckboxClickCollectiondata()" />
                </td>
            `;

            flowCounter++;

            let amountInput = newRow.querySelector("input[name='flow_amtvals']");
            amountInput.addEventListener("input", updateBalance);
            amountInput.addEventListener("blur", function () {
                formatAmountAndUpdate(this);
                updateBalance();
            });

            updateBalance();
        },
        error: function () {
            $('#errorMessage').text('Error fetching data');
            $('#errorModal').modal('show');
        }
    });
}

function addloanRow1() {
    var accountNumber = document.getElementById("acct_num123456").value;

    $.ajax({
        type: 'GET',
        url: './getloanclosetdatas511',
        data: { accountNumber: accountNumber }, 
        success: function (data) {
            let table = document.getElementById("flowIdTbodynew1"); 

            let newRow = table.insertRow();
            newRow.classList.add("deletable-row"); 

            newRow.innerHTML = `
                <td><input type="text" name="flow_date" class="border-0" value="${data.tran_date || ''}" readonly></td>
                <td><input type="text" name="flow_id" value="${flowCounter}" class="border-0" readonly /></td>
                <td><input type="text" name="flow_code" value="FEEDEM" class="border-0" readonly /></td>
                <td style="text-align:right;">
                    <input type="text" name="flow_amtvals1" class="border-0 text-right" />
                </td>
                <td><input type="text" name="loan_acct_no" class="border-0" value="${data.loan_data.loan_acct_no}" readonly /></td>
                <td><input type="text" name="acct_name" class="border-0" value="${data.loan_data.acct_name}" readonly /></td>
                <td>
                    <input type="radio" name="row_select" data-encoded_key="${data.loan_data.id}" onclick="handleCheckboxClickCollectiondata1()" />
                </td>
            `;

            flowCounter++;

            let amountInput = newRow.querySelector("input[name='flow_amtvals1']");
            amountInput.addEventListener("input", updateBalance1);
            amountInput.addEventListener("blur", function () {
                formatAmountAndUpdate(this);
                updateBalance1();
            });

            updateBalance1();
        },
        error: function () {
            $('#errorMessage').text('Error fetching data');
            $('#errorModal').modal('show');
        }
    });
}

function updateBalance() {
    let total = 0;
    
    let balanceElem = document.getElementById("acct_balancedatas");

    if (!balanceElem) {
        console.error("Error: Balance field not found!");
        return;
    }

    // Get the original balance only if it's not already set
    if (!balanceElem.dataset.originalBalance) {
        balanceElem.dataset.originalBalance = balanceElem.value.replace(/,/g, "") || "0";
    }

    let initialBalance = parseFloat(balanceElem.dataset.originalBalance) || 0;

    // Loop through all input fields with name 'flow_amtvals' and sum their values
    document.querySelectorAll("input[name='flow_amtvals']").forEach(input => {
        let value = parseFloat(input.value.replace(/,/g, "")) || 0;
        total += value;
    });

    let finalBalance = initialBalance + total;

    // Debugging - Ensure values are updating correctly
    console.log("Initial Balance:", initialBalance);
    console.log("Total Flow Amount:", total);
    console.log("Final Balance:", finalBalance);

    // Update the loan balance field with the new total
    balanceElem.value = finalBalance.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
}

function updateBalance1() {
    let total = 0;
    
    let balanceElem = document.getElementById("acct_balancedatas1");

    if (!balanceElem) {
        console.error("Error: Balance field not found!");
        return;
    }

    // Get the original balance only if it's not already set
    if (!balanceElem.dataset.originalBalance) {
        balanceElem.dataset.originalBalance = balanceElem.value.replace(/,/g, "") || "0";
    }

    let initialBalance = parseFloat(balanceElem.dataset.originalBalance) || 0;

    // Loop through all input fields with name 'flow_amtvals' and sum their values
    document.querySelectorAll("input[name='flow_amtvals1']").forEach(input => {
        let value = parseFloat(input.value.replace(/,/g, "")) || 0;
        total += value;
    });

    let finalBalance = initialBalance + total;

    // Debugging - Ensure values are updating correctly
    console.log("Initial Balance:", initialBalance);
    console.log("Total Flow Amount:", total);
    console.log("Final Balance:", finalBalance);

    // Update the loan balance field with the new total
    balanceElem.value = finalBalance.toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    });
}


function formatAmountAndUpdate(input) {
    let value = input.value.replace(/,/g, "").trim();
    if (value !== "" && !isNaN(value)) {
        input.value = parseFloat(value).toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    } else {
        input.value = ""; // Clear field if empty
    }
}

/* // Ensure existing inputs update the balance when typing
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("input[name='flow_amtvals']").forEach(input => {
        input.addEventListener("input", updateBalance);
        input.addEventListener("blur", function () {
            formatAmountAndUpdate(this);
        });
    });
});
 */
</script>
<script>
    function showPreClosure() {
        document.getElementById("preclosuredatas").style.display = "block";
        document.getElementById("closuredatas").style.display = "none";
        document.getElementById("loanHeader").innerHTML = "LOAN PRE - CLOSURE";
    }

    function showClosure() {
        document.getElementById("preclosuredatas").style.display = "none";
        document.getElementById("closuredatas").style.display = "block";
        document.getElementById("loanHeader").innerHTML = "LOAN CLOSURE";
    }

    function getActiveAccountNumber() {
        let input1 = document.getElementById("acct_num1234");
        let input2 = document.getElementById("acct_num123456");

        if (input1 && input1.offsetParent !== null && input1.value.trim() !== "") {
            return input1.value.trim();
        }

        if (input2 && input2.offsetParent !== null && input2.value.trim() !== "") {
            return input2.value.trim();
        }

        return null;
    }

    function schedulePreClosure() {
        event.preventDefault();
        const acctNum = getActiveAccountNumber();

        if (!acctNum) {
            $('#mypopup22').modal('show');
            $("#popupmsg_body").html("Account number is required!...");
            return;
        }

        // If needed, change this URL based on whether it's pre-closure or closure
        location.href = 'drawDownLoanMaintanace?formmode=view&loan_accountno=' + acctNum;
    }

    function ledgerPreClosure() {
        event.preventDefault();
        const acctNum = getActiveAccountNumber();

        if (!acctNum) {
            $('#mypopup22').modal('show');
            $("#popupmsg_body").html("Account number is required!...");
            return;
        }

        location.href = 'accountLedger2?formmode=view&acct_num=' + acctNum;
    }
</script>
</head>
<body>

	<div class="col-sm-2">
		<div th:insert="BGLSHeaderMenu :: header"></div>
	</div>
	<!---------------------User List Starts------------------------------------------------------->
	<!-- Start Content-->
	<div class="container-manager">
		<div class="row">
			<div class="col-sm-11 ml-5 mt-2">

				<div th:if="${formmode}=='list'">
					<div class="card-header"
						style="background-color: #e9ecef; height: 50px; padding-left: 5px;">
						<div class="float-left">
							<h6 id="loanHeader" style="font-size: 1.2rem; color: black;"
								class="ml-4">LOAN PRE - CLOSURE</h6>
						</div>

						<input type="hidden" id="hidden_acct_name" value=""
							style="display: none;">

						<div class="float-right">
							<button class="btn P-2" id="repaymentschedule"
								onclick="schedulePreClosure()" style="display: none;">SCHEDULER</button>
							<button class="btn P-2" id="ledgerschedule"
								onclick="ledgerPreClosure()" style="display: none;">LEDGER</button>
							<button class="btn P-2" onclick="showPreClosure();">PRE
								- CLOSURE</button>
							<button class="btn P-2" onclick="showClosure();">CLOSURE</button>
						</div>
					</div>

					<div class="card-body border" id="preclosuredatas">

						<!-- Main Row for Transaction Type and Account Type Sections in a Single Row -->
						<!-- Section Heading: Date Range -->
						<div class="row formline mt-3 " id="fromtovalues"
							style="padding-left: 20px;">
							<!-- From Date -->
							<div class="col-sm-1">Account No</div>
							<div class="col-sm-2">
								<select name="acct_num" id="acct_num1234"
									onchange="updateAccountName(this); fetchacctnum();">
									<option th:selected="${empty == ''}" value="">Select</option>
									<option th:each="ref : ${booking}" th:value="${ref[0]}"
										th:attr="data-acct-name=${ref[1]}, data-acct-namevalues=${ref[1]}"
										th:text="${ref[0]}"></option>
								</select>
							</div>

							<div class="col-sm-1">Account Name</div>
							<div class="col-sm-2">
								<input type="text" name="acct_name" id="acct_name"
									autocomplete="off" />
							</div>

							<div class="col-sm-1">Date of Closure</div>
							<div class="col-sm-2">
								<input type="date" name="date_closure" id="date_closure" />
							</div>

							<div class="col-sm-1">Loan Balance</div>
							<div class="col-sm-2">
								<input type="text" name="loan_bal" id="loan_bal"
									autocomplete="off" />
							</div>
						</div>
						<div class="row formline mt-3 " id="fromtovalues"
							style="padding-left: 20px;">
							<div class="col-sm-9"></div>
							<div class="col-sm-1">Closure Balance</div>
							<div class="col-sm-2">
								<input type="text" name="loan_bal" id="acct_balancedatas"
									autocomplete="off" />
							</div>
						</div>
						<!-- Table -->
						<table class="table table-bordered table-sm mt-4  d-none"
							style="margin-bottom: 0px; font-size: initial;" id="flowIdTable">
							<thead class="thead-light">
								<tr>
									<th>Flow Date</th>
									<th>Flow ID</th>
									<th>Flow Code</th>
									<th>Flow Amt</th>
									<th>Acct No</th>
									<th>Acct Name</th>
									<th>Select</th>
								</tr>
							</thead>

							<tbody id="flowIdTbody">
								<tr>
									<td colspan="7" style="text-align: center;">No records
										available</td>
								</tr>
							</tbody>
						</table>

						<div class="mt-4"
							style="display: flex; justify-content: right; margin-bottom: 10px;">
							<img th:src="@{/images/add.png}" aria-hidden="true"
								style="cursor: pointer; width: 20px; height: 20px; margin-right: 10px;"
								onclick="addloanRow()" alt="Add"> <img
								th:src="@{/images/MinusIcon.png}" aria-hidden="true"
								style="cursor: pointer; width: 20px; height: 20px;"
								onclick="deleteloanRow()" alt="Remove">
						</div>

						<table class="table table-bordered table-sm mt-2"
							style="margin-bottom: 0px; font-size: initial;"
							id="serviceflowIdTable">
							<thead class="thead-light">
								<tr>
									<th>Flow Date</th>
									<th>Flow ID</th>
									<th>Flow Code</th>
									<th style="text-align: center;">Flow Amt</th>
									<th>Acct No</th>
									<th>Acct Name</th>
									<th>Select</th>
								</tr>
							</thead>

							<tbody id="flowIdTbodynew">

							</tbody>
						</table>
					</div>

					<div class="card-body" style="display: none;" id="closuredatas">

						<!-- Main Row for Transaction Type and Account Type Sections in a Single Row -->
						<!-- Section Heading: Date Range -->
						<div class="row formline mt-3 " id="fromtovalues"
							style="padding-left: 20px;">
							<!-- From Date -->
							<div class="col-sm-1">Account No</div>
							<div class="col-sm-2">
								<select name="acct_num" id="acct_num123456"
									onchange="updateAccountName1(this); fetchacctnum1();">
									<option th:selected="${empty == ''}" value="">Select</option>
									<option th:each="ref : ${booking}" th:value="${ref[0]}"
										th:attr="data-acct-name=${ref[1]}, data-acct-namevalues=${ref[1]}"
										th:text="${ref[0]}"></option>
								</select>
							</div>

							<div class="col-sm-1">Account Name</div>
							<div class="col-sm-2">
								<input type="text" name="acct_name" id="acct_name1"
									autocomplete="off" />
							</div>

							<div class="col-sm-1">Date of Closure</div>
							<div class="col-sm-2">
								<input type="date" name="date_closure" id="date_closure" />
							</div>

							<div class="col-sm-1">Loan Balance</div>
							<div class="col-sm-2">
								<input type="text" name="loan_bal" id="loan_bal1"
									autocomplete="off" />
							</div>
						</div>
						<div class="row formline mt-3 " id="fromtovalues"
							style="padding-left: 20px;">
							<div class="col-sm-9"></div>
							<div class="col-sm-1">Closure Balance</div>
							<div class="col-sm-2">
								<input type="text" name="loan_bal" id="acct_balancedatas1"
									autocomplete="off" />
							</div>
						</div>
						<!-- Table -->
						<table class="table table-bordered table-sm mt-4  d-none"
							style="margin-bottom: 0px; font-size: initial;" id="flowIdTable">
							<thead class="thead-light">
								<tr>
									<th>Flow Date</th>
									<th>Flow ID</th>
									<th>Flow Code</th>
									<th>Flow Amt</th>
									<th>Acct No</th>
									<th>Acct Name</th>
									<th>Select</th>
								</tr>
							</thead>

							<tbody id="flowIdTbody">
								<tr>
									<td colspan="7" style="text-align: center;">No records
										available</td>
								</tr>
							</tbody>
						</table>

						<div class="mt-4"
							style="display: flex; justify-content: right; margin-bottom: 10px;">
							<img th:src="@{/images/add.png}" aria-hidden="true"
								style="cursor: pointer; width: 20px; height: 20px; margin-right: 10px;"
								onclick="addloanRow1()" alt="Add"> <img
								th:src="@{/images/MinusIcon.png}" aria-hidden="true"
								style="cursor: pointer; width: 20px; height: 20px;"
								onclick="deleteloanRow1()" alt="Remove">
						</div>

						<table class="table table-bordered table-sm mt-2"
							style="margin-bottom: 0px; font-size: initial;"
							id="serviceflowIdTable">
							<thead class="thead-light">
								<tr>
									<th>Flow Date</th>
									<th>Flow ID</th>
									<th>Flow Code</th>
									<th>Flow Amt</th>
									<th>Acct No</th>
									<th>Acct Name</th>
									<th>Select</th>
								</tr>
							</thead>

							<tbody id="flowIdTbodynew1">

							</tbody>
						</table>
					</div>

					<div class="card-footer text-center"
						style="background-color: #e9ecef;">
						<button class="btn btn-primary P-2" onclick="Home();">Home</button>
						<button class="btn btn-primary P-2" onclick="back();">Back</button>
					</div>
				</div>
			</div>
		</div>
	</div>


	<div class="modal fade" data-backdrop="false" data-keyboard="false"
		tabindex="-1" role="dialog" aria-hidden="true" id="confirmation_modal">
		<div
			class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-body" style="text-align: center">
					<p id="popupmsg_body">Do you want to continue?</p>
					<button type="button" class="btn btn-primary" id="confirmYesBtn"
						data-dismiss="modal">Yes</button>
					<button type="button" class="btn btn-secondary" id="confirmNoBtn"
						data-dismiss="modal">No</button>
				</div>
			</div>
		</div>
	</div>



	<div class="modal fade" id="alertERE">
		<div
			class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
			<div class="modal-content" style="background-color: white;">
				<div class="menu-title-header">
					<div class="modal-title" id="exampleModalLabel"
						style="text-align: center; color: white;">ACCOUNT DETAILS</div>
				</div>
				<div class="modal-body">
					<table class="table table-bordered table-hover table-sm">
						<thead>
							<tr style="text-align: center;">
								<th style="font-weight: bold;">SOL ID</th>
								<th style="font-weight: bold;">SOL DESCRIPTION</th>
								<th style="font-weight: bold;">SELECT</th>
							</tr>
						</thead>
						<tbody id="trancheDetList">
							<tr th:each="accvals : ${solvalues}">
								<td style="text-align: left;" th:text="${accvals[0]}"></td>
								<td style="text-align: left;" th:text="${accvals[1]}"></td>
								<td style="text-align: center;"><input type="radio"
									name="radioGroup" th:data-value1="${accvals[0]}"
									th:data-value2="${accvals[1]}" onclick="requestvalue(this);" />
								</td>

							</tr>
						</tbody>
					</table>
				</div>
				<div class="card-footer text-center">
					<button type="button" class="btn btn-primary p-2"
						id="selectedAccount" onclick="closemodal();" style="color: white;">Close</button>
				</div>
			</div>
		</div>
	</div>
</body>
</html>