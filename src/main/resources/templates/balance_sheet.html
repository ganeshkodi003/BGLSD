<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<!--
	CREATED BY : PRAVEEN
	DATE : 17-09-24
-->

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css"
	href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
	th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/font-awesome/5.9.0/css/all.min.css"
	th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
	th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}">
<link rel="stylesheet" type="text/css"
	href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
	th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}">
<link rel="shortcut icon" th:href="@{/favicon.ico}" type="image/x-icon">
<link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">

<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
	th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>
<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
	th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>
<script src="/webjars/jquery/3.4.1/jquery.min.js"
	th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
	th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>

<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
	th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>

<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
	th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>

<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>
<script
	src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
	th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>
<style>
.btn {
	line-height: 0.5rem;
}

.table-bordered td, .table-bordered th {
	font-size: smaller;
}

.container-manager {
	width: 83.5%;
	padding-right: 15px;
	padding-left: 15px;
	margin-right: auto;
	margin-left: 17.3%;
	margin-top: 80px;
	margin-top: 80px;
}

.table .thead-light th {
	color: #495057;
	background-color: #e9ecef;
	border-color: #dee2e6;
	width: 23px;
}
</style>
<style>
.table-responsive {
	height: 600px;
	overflow-y: auto;
}

.modal {
	display: none;
	position: fixed;
	z-index: 1;
	left: 0;
	top: 0;
	width: 100%;
	height: 100%;
	overflow: auto;
	background-color: rgba(0, 0, 0, 0.4);
	margin-left: 350px;
}

.modal-content {
	background-color: #fefefe;
	margin: 15% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 70%;
	height: 50%;
	margin-left: 200px;
}

.modal-pass {
	background-color: #fefefe;
	margin: 15% auto;
	padding: 20px;
	border: 1px solid #888;
	width: 40%;
	height: 25%;
	margin-left: 400PX;
	margin-right: auto;
	border-radius: 10px;
	box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2);
	/* Adding shadow for depth */
	font-family: Arial, sans-serif; /* Using a more common font */
}

.close {
	color: red;
	font-size: 28px;
	font-weight: bold;
}
</style>
<style>
.password-info {
	visibility: hidden;
	width: 320px;
	background-color: #333;
	color: #fff;
	text-align: left;
	border-radius: 10px;
	padding: 10px;
	position: absolute;
	z-index: 1;
	top: calc(100% + 10px);
	left: 50%;
	transform: translateX(-50%);
	opacity: 0;
	transition: opacity 0.3s;
}

input:hover+.password-info {
	visibility: visible;
	opacity: 0.8;
}

.filterable .filters input[disabled] {
	background-color: transparent;
	border: none;
	cursor: auto;
	box-shadow: none;
	padding: 0;
	height: auto;
}

.filterable .filters input[disabled]::-webkit-input-placeholder {
	color: #333;
}

.filterable .filters input[disabled]::-moz-placeholder {
	color: #333;
}

.filterable .filters input[disabled]:-ms-input-placeholder {
	color: #333;
}

.filterable .filters input[disabled]::-webkit-input-placeholder {
	color: #333;
}
</style>

<script>
	function Home() {

		location.href = 'Dashboard';
	}

	function back() {
		window.history.back();
	}
	
	 /* document.addEventListener("DOMContentLoaded", function() {
	        const dateInput = document.getElementById("assetDate");
	        const today = new Date().toISOString().split('T')[0];
	        dateInput.value = today;
	    }); */
	
	 
	
</script>
<script>
$(document).ready(function() {
    $('#assetDate').on('change', function() {
       
        const balancedate = this.value; // Store the selected date
        console.log('Selected Date:', balancedate);

        $.ajax({
            url: './assetliability',
            data: { balancedate: balancedate },
            type: 'GET',
            success: function(data) {
                console.log('Data received:', data);

                // Clear the tables before appending new rows
                $('#income').empty();
                $('#liability').empty();

                // Initialize total balances
                let totalBalance = 0;
                let totalLiabilityBalance = 0;

                // Check if data.msg exists for income
                if (data.msg && Array.isArray(data.msg)) {
                    data.msg.forEach(trial => {
                        const row = document.createElement('tr');

                        let formattedBalance = trial[4] == 0 ? '0.00' : Number(trial[4].toString().replace('-', '')).toLocaleString(undefined, {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });

                        // Calculate the total balance
                        totalBalance += parseFloat(trial[4].toString().replace('-', ''));

                        row.innerHTML = `
                        	<td>${trial[0]}</td>
                            <td>${trial[1]}</td>
                            <td>${trial[2]}</td>
                            <td>${trial[3]}</td>
                            <td style="text-align: right;">${formattedBalance}</td>
                        `;

                        $('#income').append(row);
                    });

                    // Format the total balance with commas and two decimal places
                    const formattedTotalBalance = totalBalance.toLocaleString(undefined, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });

                    document.getElementById('total-balance').textContent = formattedTotalBalance;
                }

                // Check if data.msg1 exists for liabilities
                if (data.msg1 && Array.isArray(data.msg1)) {
                    data.msg1.forEach(trial => {
                        const row = document.createElement('tr');

                        let formattedBalance = trial[4] == 0 ? '0.00' : Number(trial[4].toString().replace('-', '')).toLocaleString(undefined, {
                            minimumFractionDigits: 2,
                            maximumFractionDigits: 2
                        });

                        // Calculate the total balance for liabilities
                        totalLiabilityBalance += parseFloat(trial[4].toString().replace('-', ''));

                        row.innerHTML = `
                        	<td>${trial[0]}</td>
                            <td>${trial[1]}</td>
                            <td>${trial[2]}</td>
                            <td>${trial[3]}</td>
                            <td style="text-align: right;">${formattedBalance}</td>
                        `;

                        $('#liability').append(row);
                    });

                    // Format the total balance with commas and two decimal places
                    const formattedTotalLiabilityBalance = totalLiabilityBalance.toLocaleString(undefined, {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });

                    document.getElementById('totalAmount1').textContent = formattedTotalLiabilityBalance;
                }

                // Calculate the difference between total balances
              
            const numericTotalBalance = parseFloat(totalBalance.toFixed(2)) || 0;
            const numericTotalLiabilityBalance = parseFloat(totalLiabilityBalance.toFixed(2)) || 0;
            const difference = numericTotalBalance - numericTotalLiabilityBalance;
            const absoluteDifference = Math.abs(difference).toLocaleString(undefined, {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });

            // Determine profit or loss
            let statusMessage = '';
            let totalBalance1 = '';
            const statusMessageElement = document.getElementById('statusMessage'); 
            console.log("Difference:", difference); // Debugging log
            if (difference > 0) {
                statusMessage = 'Profit';
                statusMessageElement.style.color = 'green';
                totalBalance1 = `Profit Amount: ${absoluteDifference}`;
            } else if (difference < 0) {
                statusMessage = 'Loss';
                statusMessageElement.style.color = 'red';
                totalBalance1 = "Loss Amount \u00A0:" +"\u00A0 "+ ` ${absoluteDifference}`;
            } else {
                statusMessage = 'Break-even';
                statusMessageElement.style.color = 'black';
                totalBalance1 = 'No Profit or Loss';
            }

            // Display the result
            console.log(statusMessage);
            console.log("Total Balance 2:", totalBalance1); // Debugging log

            // Update the UI with the status message
            document.getElementById('statusMessage').textContent = statusMessage;
            document.getElementById('totalBalance').textContent = totalBalance1; 
        },
            error: function(err) {
                console.error('Error fetching data:', err);
            }
        });
    });
});

document.addEventListener("DOMContentLoaded", function() {
    const dateInput = document.getElementById("assetDate");
    const trandateGet = document.getElementById("trandateget").value;
    
    // Convert 'dd-MM-yyyy' to 'yyyy-MM-dd' format
    const parts = trandateGet.split("-");
    const formattedDate = `${parts[2]}-${parts[1]}-${parts[0]}`;

    // Set the formatted date to the date input
    dateInput.value = formattedDate;
});

//Filter Table

$(document)
	.ready(
			function() {
				$('.filterable .btn-filter')
						.click(
								function() {
									var $panel = $(this).parents(
											'.filterable'), $filters = $panel
											.find('.filters input'), $tbody = $panel
											.find('.table tbody');
									if ($filters.prop('disabled') == true) {
										$filters
												.prop('disabled', false);
										$filters.first().focus();
									} else {
										$filters.val('').prop(
												'disabled', true);
										$tbody.find('.no-result')
												.remove();
										$tbody.find('tr').show();
									}
								});

				$('.filterable .filters input')
						.keyup(
								function(e) {
									/* Ignore tab key */
									var code = e.keyCode || e.which;
									if (code == '9')
										return;
									/* Useful DOM data and selectors */
									var $input = $(this), inputContent = $input
											.val().toLowerCase(), $panel = $input
											.parents('.filterable'), column = $panel
											.find('.filters th')
											.index($input.parents('th')), $table = $panel
											.find('.table'), $rows = $table
											.find('tbody tr');
									/* Dirtiest filter function ever ;) */
									var $filteredRows = $rows
											.filter(function() {
												var value = $(this)
														.find('td').eq(
																column)
														.text()
														.toLowerCase();
												return value
														.indexOf(inputContent) === -1;
											});
									/* Clean previous no-result if exist */
									$table.find('tbody .no-result')
											.remove();
									/* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
									$rows.show();
									$filteredRows.hide();
									/* Prepend no-result row if all rows are filtered */
									if ($filteredRows.length === $rows.length) {
										$table
												.find('tbody')
												.prepend(
														$('<tr class="no-result text-center"><td colspan="'
																+ $table
																		.find('.filters th').length
																+ '">No result found</td></tr>'));
									}
								});
			});



</script>


</head>


<body>

	<div class="col-sm-2">
		<div th:insert="BGLSHeaderMenu :: header"></div>
	</div>
	<!---------------------User List Starts------------------------------------------------------->
	<!-- Start Content-->


	<div class="container-manager">
		<div class="row">
			<div class="col-sm-6 mt-2">

				<div th:if="${formmode}=='list'">
					<div class="panel panel-primary filterable">
						<div class="card w-100 border panel panel-primary filterable">
							<div class="card-header" style="background-color: #e9ecef">
								<div class="float-left"
									style="display: flex; margin-left: -10px; justify-content: space-between; align-items: center;">
									<h5>ASSET</h5>
									<h4 style="margin-left: 250px">BALANCE SHEET</h4>

								</div>
								<div class="float-right">
									<button type="button"
										class="btn btn-xs btn-primary btns p-2 border btn-filter">Filter</button>
								</div>
							</div>
							<div class="table-responsive">
								<table class="table table-bordered table-hover table-sm"
									style="margin-bottom: 0px; font-size: initial;" id="usertable">
									<thead class="thead-light">
										<tr class="filters">
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="GL HEAD"
												disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="GL DESC"
												disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold"
												placeholder="NO OF ACCT" disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="CURRENCY"
												disabled></th>
											<th style="text-align: right; width: 15%"><input
												type="text" class="form-control font-weight-bold"
												style="text-align: right" placeholder="AMOUNT" disabled>
											</th>
										</tr>

									</thead>
									<tbody id="income">
										<tr th:each="chartacc : ${balancesheet1}">
											<td th:text="${chartacc[0]}" style="text-align: left;"></td>
											<td th:text="${chartacc[1]}" style="text-align: left;"></td>
											<td th:text="${chartacc[2]}" style="text-align: left;"></td>
											<td th:text="${chartacc[3]}"></td>
											<td class="acct-bal" style="text-align: right;"><span th:text="${chartacc[4] == null or chartacc[4] == 0 ? '0.00' : #numbers.formatDecimal(#strings.defaultString(chartacc[4], '0').replace('-', ''), 0, 'COMMA', 2, 'POINT')}"></span>
</td>
										</tr>

									</tbody>

								</table>

							</div>

							<div class="row-formline"
								style="display: flex; align-items: right; justify-content: right; margin-right: 30px; margin-top: 10px; margin-bottom: 10px">

								<div
									style="text-align: center; font-weight: bold; margin-right: 200px;">Total:</div>
								<div id="total-balance"
									style="text-align: center; font-weight: bold;"></div>
							</div>

							<div class="card-footer text-center border-top-0"
								style="background-color: #e9ecef">
								<button type="button" class="btn btn-xs btn-primary mr-2"
									id="btnHome" onclick="Home();">Home</button>

							</div>

						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-6 mt-2">
				<div th:if="${formmode}=='list'">
					<div class="panel panel-primary filterable">
						<div class="card w-100 border panel panel-primary filterable">
							<div class="card-header" style="background-color: #e9ecef">
								<div class="d-flex justify-content-between align-items-center">
									<h5 class="mb-0">LIABILITY</h5>
									<div class="d-flex align-items-center">
										<input type="date" name="assetDate" id="assetDate"
											class="form-control form-control-sm bg-white border border-dark mr-2" />
										<input type="text" id="trandateget"
											th:value="${#dates.format(TRANDATE, 'dd-MM-yyyy')}"
											class="form-control font-weight-bold" placeholder="HEAD"
											hidden>
										<button type="button"
											class="btn btn-xs btn-primary btns p-2 border btn-filter">Filter</button>
									</div>
								</div>
							</div>


							<div class="table-responsive">
								<table class="table table-bordered table-hover table-sm"
									style="margin-bottom: 0px; font-size: initial;" id="usertable">
									<thead class="thead-light">
										<tr class="filters">
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="GL HEAD"
												disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="GL DESC"
												disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold"
												placeholder="NO OF ACCT" disabled></th>
											<th><input type="text"
												class="form-control font-weight-bold" placeholder="CURRENCY"
												disabled></th>
											<th style="text-align: right; width: 15%"><input
												type="text" class="form-control font-weight-bold"
												style="text-align: right" placeholder="AMOUNT" disabled>
											</th>
										</tr>

									</thead>
									<tbody id="liability">
										<tr th:each="chartacc : ${balancesheet2}">
											<td th:text="${chartacc[0]}" style="text-align: left;"></td>
											<td th:text="${chartacc[1]}" style="text-align: left;"></td>
											<td th:text="${chartacc[2]}" style="text-align: left;"></td>
											<td th:text="${chartacc[3]}"></td>
											<td style="text-align: right;"><span
												th:text="${chartacc[4] == 0 ? '0.00' : #numbers.formatDecimal(chartacc[4].toString().replace('-', ''), 0, 'COMMA', 2, 'POINT')}"></span>
											</td>
										</tr>

									</tbody>
								</table>

							</div>
							<div class="row-formline"
								style="display: flex; align-items: right; justify-content: right; margin-right: 30px; margin-top: 10px; margin-bottom: 10px">

								<div
									style="text-align: center; font-weight: bold; margin-right: 200px;">Total:</div>
								<div id="totalAmount1"
									style="text-align: center; font-weight: bold;"></div>
							</div>

							<div class="card-footer text-center border-top-0"
								style="background-color: #e9ecef">

								<button type="button" class="btn btn-xs btn-primary ml-2"
									id="btnBack" onclick="back();">Back</button>
							</div>

						</div>
					</div>
				</div>
			</div>

			<div class="col-sm-12 mt-2" style="font-size: 20px">
				<div class="row formline">
					<br>
					<div class="col-sm-5"></div>
					<div
						style="text-align: center; font-weight: bold; margin-top: 10px;">Report
						Status :</div>
					<div id="statusMessage"
						style="text-align: center; font-weight: bold; margin-left: 10px; margin-top: 10px;"></div>
				</div>
				<div class="row formline">
					<br>
					<div class="col-sm-5"></div>
					<div id="totalBalance"
						style="text-align: center; font-weight: bold;"></div>
				</div>
			</div>
		</div>
	</div>

	<script>
    function calculateAndCompare() {
        // Extract total amounts from the DOM and convert them to floats
        const totalProfit = parseFloat(document.getElementById('total-balance').innerText.replace(/,/g, '')) || 0;
        const totalLoss = parseFloat(document.getElementById('totalAmount1').innerText.replace(/,/g, '')) || 0;

        const difference = totalProfit - totalLoss;
        const absoluteDifference = Math.abs(difference).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        
        // Calculate the difference and determine the status
        const statusMessageElement = document.getElementById('statusMessage');
    const totalBalanceElement = document.getElementById('totalBalance');
    
    if (difference > 0) {
        statusMessageElement.textContent = 'Profit';
        statusMessageElement.style.color = 'green';

        // Display the profit amount
        totalBalanceElement.textContent = `Profit Amount: ${absoluteDifference}`;      
    } else if (difference < 0) {
        statusMessageElement.textContent = 'Loss';
        statusMessageElement.style.color = 'red'; 

        // Display the loss amount
        totalBalanceElement.textContent = "Loss Amount \u00A0:" +"\u00A0 "+ `${absoluteDifference}`;
    } else {
        statusMessageElement.textContent = 'Break-even';
        statusMessageElement.style.color = 'black';

        // Indicate that the amounts are balanced
        totalBalanceElement.textContent = 'No Profit or Loss';
        }
    }

    // Call the function after the page loads
    window.onload = calculateAndCompare;
</script>


	<script>
    function calculateTotal() {
        let total = 0;
        document.querySelectorAll('#income .acct-bal span').forEach(function(element) {
            const value = parseFloat(element.textContent.replace(/,/g, ''));
            if (!isNaN(value)) {
                total += value;
            }
        });

        // Format total with commas and two decimal places
        const formattedTotal = new Intl.NumberFormat('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        }).format(total);

        // Update the total in the table footer
        document.getElementById('total-balance').textContent = formattedTotal;
    }

    
    document.addEventListener('DOMContentLoaded', function () {
        calculateTotal();
        calculateTotal1();
    });

    function calculateTotal1() {
        let total = 0;
        const rows = document.querySelectorAll('#liability tr');

        rows.forEach(row => {
            const amountCell = row.querySelector('td:nth-child(5) span');
            if (amountCell) {
                const amount = parseFloat(amountCell.textContent.replace(/,/g, '')) || 0;
                total += amount;
            }
        });

        // Update the total row with the calculated total
        document.getElementById('totalAmount1').textContent = total.toLocaleString('en', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

</script>



</body>
</html>
